---
title: "551_Case_study"
author: "Matthew Stoebe"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

install.packages("car")

library(corrplot)
library(car)
library(psych)
library(tidyverse)
```


```{r}

# Read the CSV file
lpga_data <- read.csv("LPGA.csv")

# View the first few rows
head(lpga_data)

# Check data structure
str(lpga_data)

# Convert percentage columns to numeric if they are not already
lpga_data$pctfrwy <- as.numeric(lpga_data$pctfrwy)
lpga_data$pctgrn <- as.numeric(lpga_data$pctgrn)

# Summary of quantitative variables
summary(lpga_data)

# Detailed descriptive statistics
library(psych)
describe(lpga_data[, sapply(lpga_data, is.numeric)])

# Histogram for each quantitative variable
lpga_data %>%
  select(-Golfer) %>%
  gather(key = "variable", value = "value") %>%
  ggplot(aes(x = value)) +
  geom_histogram(bins = 20, fill = "skyblue", color = "black") +
  facet_wrap(~ variable, scales = "free") +
  theme_minimal()

predictors <- names(lpga_data)[!(names(lpga_data) %in% c("Golfer", "przrnd"))]

for (var in predictors) {
  p <- ggplot(lpga_data, aes(x = .data[[var]], y = przrnd)) +
    geom_point(color = "blue") +
    geom_smooth(method = "lm", se = FALSE, color = "red") +
    labs(title = paste("przrnd vs", var), x = var, y = "Prize Money per Round") +
    theme_minimal()
  
  print(p)
}
# Correlation matrix of quantitative variables
numeric_vars <- lpga_data %>% select(-Golfer)
cor_matrix <- cor(numeric_vars)

corrplot(cor_matrix, method = "ellipse")


```

```{r}
# Fit a multiple linear regression model with all predictors
initial_model <- lm(przrnd ~ . - Golfer, data = lpga_data)

# Summary of the model
summary(initial_model)

# Plot residuals to check assumptions
par(mfrow = c(2, 2))
plot(initial_model)
par(mfrow = c(1, 1))  # Reset plotting area

# Q-Q plot
qqnorm(residuals(initial_model))
qqline(residuals(initial_model), col = "red")

```

#Log Transform on Response
```{r}
log_response <- lm(log(przrnd) ~ . - Golfer, data = lpga_data)

# Summary of the model
summary(log_response)

# Plot residuals to check assumptions
par(mfrow = c(2, 2))
plot(log_response)
par(mfrow = c(1, 1))  # Reset plotting area

# Q-Q plot
qqnorm(residuals(log_response))
qqline(residuals(log_response), col = "red")


```
```{r}
# Fit a linear model with selected predictors
model_reduced <- lm(log(przrnd) ~ rounds + pctgrn + aveputt, data = lpga_data)

# Check the model summary
summary(model_reduced)

# Diagnostic plots to evaluate the reduced model fit
par(mfrow = c(2, 2))
plot(model_reduced)

```
```{r}
# Load the necessary packages
library(loo)
library(boot)
```


```{r}
# Remove the 'Golfer' column from the dataset as it is a unique identifier
lpga_data_clean <- lpga_data %>% select(-Golfer)

# Function to compute LOO for a given model
loo_cv <- function(model) {
  loo_result <- cv.glm(lpga_data_clean, model, K = nrow(lpga_data_clean))
  return(loo_result$delta[1])
}

# Perform LOO for the initial model
initial_model <- lm(przrnd ~ ., data = lpga_data_clean)
initial_loo <- loo_cv(initial_model)

# Perform LOO for the log-transformed model
log_response <- lm(log(przrnd) ~ ., data = lpga_data_clean)
log_response_loo <- loo_cv(log_response)

# Perform LOO for the reduced model
model_reduced <- lm(log(przrnd) ~ rounds + pctgrn + aveputt, data = lpga_data_clean)
model_reduced_loo <- loo_cv(model_reduced)

# Print LOO results for comparison
cat("Initial Model LOO:", initial_loo, "\n")
cat("Log-Transformed Model LOO:", log_response_loo, "\n")
cat("Reduced Model LOO:", model_reduced_loo, "\n")

# Calculate and compare adjusted R-squared values
initial_adj_r2 <- summary(initial_model)$adj.r.squared
log_response_adj_r2 <- summary(log_response)$adj.r.squared
reduced_adj_r2 <- summary(model_reduced)$adj.r.squared

cat("Initial Model Adjusted R-squared:", initial_adj_r2, "\n")
cat("Log-Transformed Model Adjusted R-squared:", log_response_adj_r2, "\n")
cat("Reduced Model Adjusted R-squared:", reduced_adj_r2, "\n")


```

